<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="font/iconfont.css">
    <link rel="stylesheet" href="font1/iconfont.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/swiper-bundle.min.css">
    <script src="js/swiper-bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="js/jquery-1.11.3.js"></script>
    <script src="js/index.js"></script>
    <link rel="stylesheet" href="css/cart.css">
    <title>购物车</title>
</head>

<body>
    <div class="site-header-wrap" style="border-bottom: 1px solid #ff6700;">
        <div class="site-header">
            <div class="header-logo">
                <a href="#"><img src="images/logo.png" alt="" width="56px"></a>
            </div>
            <div class="header-nav">
                <ul class="one">
                    <h2 style="float: left; margin-left: 30px; font-size: 28px;">我的购物车</h2>
                    <span style="margin-left: 10px;">温馨提示：产品是否购买成功，以最终下单为准哦，请尽快结算</span>
                </ul>
            </div>
        </div>
    </div>
    <div class="cart-mi" style="padding-top: 20px;">
        <div class="content-mi container">
            <div class="row fat1">
                <div class="col-md-2">
                    <i><input type="checkbox" id="checkAll"> </i>
                    <i>全选</i>
                </div>
                <div class="col-md-3">商品名称</div>
                <div class="col-md-1">单价</div>
                <div class="col-md-3">数量</div>
                <div class="col-md-2">小计</div>
                <div class="col-md-1">操做</div>
            </div>
            <ul id="fat">
            </ul>
        </div>
        <div class="mi-carto">
            <div class="mi-cartol">
                <a href="index.html"><span>继续购物</span></a>
                <span>|</span>
                <i>共<span id="pan" class="gong">3</span>件商品，已经选择<span id="pan" class="xuanze">0</span>件</i>
            </div>
            <div class="mi-cartor">
                <i>合计：<span class="iq">0元</span></i>
                <i class="ic">去结算</i>
            </div>
        </div>
    </div>
    <div class="footer clean">
        <div class="one">
            <ul>
                <li style="border-left: none;"><a href=""><em style="margin-top: 2px;" class="iconfont icon-gongju
                    "></em>预约维修服务</a> </li>
                <li><a href=""><em class="iconfont icon-qitianwuliyoutuihuan
                    "></em>7天无理由退货</a> </li>
                <li><a href=""><em class="iconfont icon-15tianwuliyoutuihuo
                    "></em>15天免费换货</a> </li>
                <li><a href=""><em class="iconfont icon-liwu"></em>满69包邮</a> </li>
                <li><a href=""><em class="iconfont icon-icon-test"></em>520余家售后网点</a> </li>
            </ul>
        </div>
        <div class="two clean">
            <dl>
                <dt>帮助中心</dt>
                <dd>账户管理</dd>
                <dd>购物指南</dd>
                <dd>订单操作</dd>
            </dl>
            <dl>
                <dt>服务支持</dt>
                <dd>售后服务</dd>
                <dd>相关下载</dd>
                <dd>售后政策</dd>
            </dl>
            <dl>
                <dt>线下门店</dt>
                <dd>小米之家</dd>
                <dd>服务网点</dd>
                <dd>授权体验店</dd>
            </dl>
            <dl>
                <dt>关于小米</dt>
                <dd>了解小米</dd>
                <dd>加入小米</dd>
                <dd>投资者关系</dd>
                <dd>企业社会责任</dd>
                <dd>廉洁举报</dd>
            </dl>
            <dl>
                <dt>关注我们</dt>
                <dd>新浪微博</dd>
                <dd>官方微信</dd>
                <dd>联系我们</dd>
                <dd>公益基金会</dd>
            </dl>
            <dl>
                <dt>特色服务</dt>
                <dd>F码通道</dd>
                <dd>礼物码</dd>
                <dd>防伪查询</dd>
            </dl>
            <div class="serve">
                <p style="font-size: 22px;line-height: 1;color: #ff6700; margin: 0 0 5px 0;">400-100-5678</p>
                <p style="font-size: 12px; margin: 0 0 5px 0;">8:00-18:00(仅收市话费)</p>
                <a class="ke" href=""><em class="iconfont icon-xinxi"></em>人工客服</a>
                <div class="follow">关注小米：
                    <a><i class="iconfont icon-logo-weibo
                        "></i></a>
                    <a><i class="iconfont icon-weixin"></i></a>
                </div>
            </div>
        </div>
        <div class="three clean">
            <div class="two clean">
                <div class="lg"></div>
                <div class="info-text">
                    <p class="foot">
                        <a href="">小米商城</a>
                        <span>|</span>
                        <a href="">MIUI</a>
                        <span>|</span>
                        <a href="">米家</a>
                        <span>|</span>
                        <a href="">米聊</a>
                        <span>|</span>
                        <a href="">多看</a>
                        <span>|</span>
                        <a href="">游戏</a>
                        <span>|</span>
                        <a href="">政企服务</a>
                        <span>|</span>
                        <a href="">小米天猫店</a>
                        <span>|</span>
                        <a href="">小米集团隐私政策</a>
                        <span>|</span>
                        <a href="">小米公司儿童信息保护规则</a>
                        <span>|</span>
                        <a href="">小米商城隐私政策</a>
                        <span>|</span>
                        <a href="">小米商城用户协议</a>
                        <span>|</span>
                        <a href="">问题反馈</a>
                        <span>|</span>
                        <a href="">Select Location</a>
                    </p>
                    <p class="foot">
                        <a href="">北京互联网法院法律服务工作站</a>
                        <span>|</span>
                        <a href="">中国消费者协会</a>
                        <span>|</span>
                        <a href="">北京市消费者协会</a>
                    </p>
                    <p class="foot oo" style="color: #b0b0b0;font-size: 12px;">
                        ©
                        <a style="color: #b0b0b0;" href="">mi.com</a> 京ICP正10507号
                        <a href="">京ICP备1006444号</a>
                        <a href="">京公网安备11010802020134号</a>
                        <a href="">京网文[2020]0276-042号</a><br>
                        <a href="">(京)网协平台备字(2018)第00005号</a>
                        <a href="">互联网药品信息服务资格证 (京)-非经营性-2014-0090</a>
                        <a href="">营业执照</a>
                        <a href="">医疗器械质量公告</a>
                        <br>
                        <a href="">增值电信业务许可证</a>&nbsp; 网络食品经营备案 京食药网食备202010048&nbsp;
                        <a href="">食品经营许可证</a><br>
                        违法和不良信息举报电话：171-5104-4404 &nbsp;
                        <a href="">知识产权侵权投诉</a>
                        &nbsp; 本网站所列数据，除特殊说明，所有数据均出自我司实验室测试
                    </p>
                </div>
                <div class="info-link">
                    <a href=""><img src="https://i1.mifile.cn/f/i/17/site/truste.png" alt=""></a>
                    <a href=""><img src="https://s01.mifile.cn/i/v-logo-2.png" alt=""></a>
                    <a href=""><img src="https://xyt.xinchacha.com/img/icon/icon3.png" alt=""></a>
                    <a href=""><img src="https://i8.mifile.cn/b2c-mimall-media/ba10428a4f9495ac310fd0b5e0cf8370.png"
                            alt=""></a>
                    <a href="" id="act"><img class="active"
                            src="https://cnbj1.fds.api.xiaomi.com/b2c-misite-activity/f1ee261b96ae71e845efba398efeca02.png"
                            alt="">
                        <img src="https://cnbj1.fds.api.xiaomi.com/b2c-misite-activity/4fbb07080ae3182a693b8c31732a0665.png"
                            alt=""></a>
                </div>
                <div class="four">
                </div>
            </div>
        </div>
    </div>
    <script src="js/cookie.js"></script>
    <script src="js/index.js"></script>
    <script src="js/cart.js"></script>
    <script>
        var oIn = document.querySelector("#sp");
        var tU = document.querySelector("#tuichu");
        var denglu = document.querySelector("#denglu");
        var scr = document.querySelector("#scr");
        $("#sp").mouseover(function () {
            $("#sp").css("background-color", "#fff")
        })
        var swiper = new Swiper('.swiper-container', {
            spaceBetween: 30,
            effect: 'fade',
            autoplay: true,
            loop: true,
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
                autoplay: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });
        $("#sp").hover(function () {
            $(".pingjia").slideDown()
        })
        $(".pingjia").mouseleave(function () {
            $(".pingjia").slideUp()
            $("#sp").css("background-color", "#333")
        })
        $(".one").hover(function () {
            // console.log("1")
            $(".xiala").slideToggle("fast")
        })
        var a = 0;
        //console.log($("#act"))
        setInterval(function () {
            if (a == 2) {
                a = 0;
            }
            $("#act img").eq(a).addClass("active").siblings().removeClass("active");
            a++
        }, 2000)
        $(".less li").eq(0).css({ "color": "#ff6700", "borderColor": "#ff6700" })
        $(".less li").eq(0).hover(function () {
            $(this).css({ "color": "#ff6700", "borderColor": "#ff6700" }).siblings().css({ "color": "#333", "borderColor": "#f5f5f5" })
            $(".sp6 ul").eq(0).addClass("chen").siblings().removeClass("chen");
            console.log($(".less li").index);
        })
        $(".less li").eq(1).hover(function () {
            $(".sp6 ul").eq(1).addClass("chen").siblings().removeClass("chen")
            $(this).css({ "color": "#ff6700", "borderColor": "#ff6700" }).siblings().css({ "color": "#333", "borderColor": "#f5f5f5" })
        })
        $.get("http://jx.xuzhixiang.top/ap/api/cart-list.php", {
            id: getCookie("miid")
        }).then(res => {
            let str = "";
            let arr = [];
            for (let i = 0; i < res.data.length; i++) {
                arr.push(res.data[i].pid)
                str += `
        <div class="row row1"}> 
        <div class="col-md-1 zhong"> 
        <i><input type="checkbox" class="checkone" class="ce"> </i> 
        </div> 
        <div class="col-md-1 zhong"> 
        <img src="${res.data[i].pimg}" 
        alt=""> 
        </div> 
        <div class="col-md-2 zhong">${res.data[i].pname}</div> 
        <div class="col-md-1 zhong"></div> 
        <div class="col-md-1 zhong onesum">${res.data[i].pprice}</div> 
        <div class="col-md-2 "> 
        <div class="box2 "> 
        <li class="jian">-</li> 
        <input class="pum" id="${res.data[i].pid}" value="${res.data[i].pnum} ">
        <li class="jia">+</li> 
        </div> 
        </div> 
        <div class="col-md-1 zhong"></div> 
        <div class="col-md-1 zhong pprice">${res.data[i].pprice * res.data[i].pnum}</div> 
        <div class="col-md-1 zhong"></div> 
        <div class="col-md-1 yuan"> 
        <i class="del" id="${res.data[i].pid}">X</i> 
        </div> 
        </div> `;
            }
            fat.innerHTML = str;
            let fat9 = document.querySelector("#fat");
            let fatt = document.querySelector(".fat1");
            let fata = document.querySelector(".mi-carto");
            let gong = document.querySelector(".gong")
            let xuanze = document.querySelector(".xuanze")
            if (fat9.children.length == 0) {
                fatt.style.display = "none";
                fata.style.display = "none";
            } else {
                fatt.style.display = "block";
                fata.style.display = "block";
            }
            let checkall = document.querySelector("#checkAll")
            let checkone = document.getElementsByClassName("checkone")
            let pnum = document.querySelectorAll(".pum")
            for (let i = 0; i < checkone.length; i++) {
                checkone[i].onclick = () => {
                    let count = 0;
                    for (let j = 0; j < checkone.length; j++) {
                        if (checkone[j].checked) {
                            count++;
                        }
                    };
                    if (count === checkone.length) {
                        checkall.checked = true;
                    } else {
                        checkall.checked = false;
                    }
                    getTotalPrice();
                }
            }
            let pprice = document.querySelectorAll(".pprice")
            checkall.onclick = () => {
                for (let i = 0; i < checkone.length; i++) {
                    checkone[i].checked = checkall.checked;
                }
                getTotalPrice();
            }
            let iq = document.querySelector(".iq");

            function getSum() {
                let a = 0;
                for (let i = 0; i < checkone.length; i++) {
                    if ($(".ce").eq(i).prop("checked") == true) {
                        a += parseInt($(".ce").eq(i).parent().parent().siblings(".pprice").html());
                    }
                }
                return a;
            }
            function getTotalPrice() {
                let total = 0;
                let n = 0;
                for (let i = 0; i < checkone.length; i++) {
                    if (checkone[i].checked) {
                        total += Number($(".pprice").eq(i).text());
                        n++;
                    }
                };
                xuanze.innerText = n;
                iq.innerText = total + "元";
                gong.innerHTML = checkone.length;
            }
            $(".pum").on("input", function () {
                $.get("http://jx.xuzhixiang.top/ap/api/cart-update-num.php", {
                    pid: $(this).attr("id"),
                    uid: getCookie("miid"),
                    pnum: $(this).val()
                }).then(res => {
                    $.get("http://jx.xuzhixiang.top/ap/api/cart-list.php", {
                        id: getCookie("miid")
                    }).then(res => {
                        // for (let i = 0; i < pprice.length; i++) {
                        // $(".pprice").eq(i).innerText = parseInt(res.data[i].pprice) * parseInt(res.data[i].pnum)
                        $(this).parent().parent().siblings(".pprice").text($(this).val() * $(this).parent().parent().siblings(".onesum").text());
                        // }
                        getTotalPrice();
                    })
                })
            })
            //  let jia = document.querySelectorAll(".jia")
            $(".jia").click(function () {
                let a = $(this).siblings(".pum").val();
                $(this).siblings(".pum").val(++a);
                $.get("http://jx.xuzhixiang.top/ap/api/cart-update-num.php", {
                    pid: $(this).siblings(".pum").attr("id"),
                    uid: getCookie("miid"),
                    pnum: $(this).siblings(".pum").val()
                }).then(res => {
                    $.get("http://jx.xuzhixiang.top/ap/api/cart-list.php", {
                        id: getCookie("miid")
                    }).then(res => {
                        $(this).parent().parent().siblings(".pprice").text(a * $(this).parent().parent().siblings(".onesum").text());
                        getTotalPrice();
                    })
                })
            })
            //}
            //let jian = document.querySelectorAll(".jian")
            $(".jian").click(function () {
                if ($(this).siblings(".pum").val() <= 1) {
                    $(this).siblings(".pum").val(2)
                }
                let a = $(this).siblings(".pum").val();
                b = $(this).siblings(".pum").val(--a);
                $.get("http://jx.xuzhixiang.top/ap/api/cart-update-num.php", {
                    pid: $(this).siblings(".pum").attr("id"),
                    uid: getCookie("miid"),
                    pnum: $(this).siblings(".pum").val()
                }).then(res => {
                    $.get("http://jx.xuzhixiang.top/ap/api/cart-list.php", {
                        id: getCookie("miid")
                    }).then(res => {
                        for (let i = 0; i < pprice.length; i++) {
                            $(this).parent().parent().siblings(".pprice").text(a * $(this).parent().parent().siblings(".onesum").text());
                            getTotalPrice();
                        }
                    })
                })
            })
            $(".del").click(function () {
                $.get("http://jx.xuzhixiang.top/ap/api/cart-delete.php", {
                    pid: $(this).attr("id"),
                    uid: getCookie("miid")
                }).then(res => {
                    $.get("http://jx.xuzhixiang.top/ap/api/cart-list.php", {
                        id: getCookie("miid")
                    }).then(res => {
                        $(this).parent().parent().remove()
                        if (fat9.children.length == 0) {
                            fatt.style.display = "none";
                            fata.style.display = "none";
                        } else {
                            fatt.style.display = "block";
                            fata.style.display = "block";
                        }
                        let count = 0;
                        for (let j = 0; j < checkone.length; j++) {
                            console.log($(".pprice").eq(j).text())
                            if (checkone[j].checked) {
                                count++;
                            }
                        }
                        console.log(count)
                        if (count == checkone.length && count != 0) {
                            checkall.checked = true
                        } else {
                            checkall.checked = false
                        }
                        getTotalPrice()
                    })
                })
            })
        })
    </script>
</body>

</html>