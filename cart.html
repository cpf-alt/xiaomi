<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="font/iconfont.css">
    <link rel="stylesheet" href="font1/iconfont.css">
    <link rel="stylesheet" href="css/index.css">
    <link rel="stylesheet" href="css/swiper-bundle.min.css">
    <script src="js/swiper-bundle.min.js"></script>
    <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="js/jquery-1.11.3.js"></script>
    <script src="js/index.js"></script>
    <link rel="stylesheet" href="css/cart.css">
    <title>购物车</title>
</head>

<body>
    <div class="site-header-wrap" style="border-bottom: 1px solid #ff6700;">
        <div class="site-header">
            <div class="header-logo">
                <a href="#"><img src="images/logo.png" alt="" width="56px"></a>
            </div>
            <div class="header-nav">
                <ul class="one">
                    <h2 style="float: left; margin-left: 30px; font-size: 28px;">我的购物车</h2>
                    <span style="margin-left: 10px;">温馨提示：产品是否购买成功，以最终下单为准哦，请尽快结算</span>
                </ul>
            </div>
        </div>
    </div>
    <div class="cart-mi" style="padding-top: 20px;">
        <div class="content-mi container">
            <div class="row fat1">
                <div class="col-md-2">
                    <i><input type="checkbox" id="checkAll"> </i>
                    <i>全选</i>
                </div>
                <div class="col-md-3">商品名称</div>
                <div class="col-md-1">单价</div>
                <div class="col-md-3">数量</div>
                <div class="col-md-2">小计</div>
                <div class="col-md-1">操做</div>
            </div>
            <ul id="fat">
            </ul>
        </div>
        <div class="mi-carto">
            <div class="mi-cartol">
                <a href="index.html"><span>继续购物</span></a>
                <span>|</span>
                <i>共<span id="pan" class="gong">3</span>件商品，已经选择<span id="pan" class="xuanze">0</span>件</i>
            </div>
            <div class="mi-cartor">
                <i>合计：<span class="iq">0元</span></i>
                <i class="ic">去结算</i>
            </div>
        </div>
    </div>
    <div class="footer clean">
        <div class="one">
            <ul>
                <li style="border-left: none;"><a href=""><em style="margin-top: 2px;" class="iconfont icon-gongju
                    "></em>预约维修服务</a> </li>
                <li><a href=""><em class="iconfont icon-qitianwuliyoutuihuan
                    "></em>7天无理由退货</a> </li>
                <li><a href=""><em class="iconfont icon-15tianwuliyoutuihuo
                    "></em>15天免费换货</a> </li>
                <li><a href=""><em class="iconfont icon-liwu"></em>满69包邮</a> </li>
                <li><a href=""><em class="iconfont icon-icon-test"></em>520余家售后网点</a> </li>
            </ul>
        </div>
        <div class="two clean">
            <dl>
                <dt>帮助中心</dt>
                <dd>账户管理</dd>
                <dd>购物指南</dd>
                <dd>订单操作</dd>
            </dl>
            <dl>
                <dt>服务支持</dt>
                <dd>售后服务</dd>
                <dd>相关下载</dd>
                <dd>售后政策</dd>
            </dl>
            <dl>
                <dt>线下门店</dt>
                <dd>小米之家</dd>
                <dd>服务网点</dd>
                <dd>授权体验店</dd>
            </dl>
            <dl>
                <dt>关于小米</dt>
                <dd>了解小米</dd>
                <dd>加入小米</dd>
                <dd>投资者关系</dd>
                <dd>企业社会责任</dd>
                <dd>廉洁举报</dd>
            </dl>
            <dl>
                <dt>关注我们</dt>
                <dd>新浪微博</dd>
                <dd>官方微信</dd>
                <dd>联系我们</dd>
                <dd>公益基金会</dd>
            </dl>
            <dl>
                <dt>特色服务</dt>
                <dd>F码通道</dd>
                <dd>礼物码</dd>
                <dd>防伪查询</dd>
            </dl>
            <div class="serve">
                <p style="font-size: 22px;line-height: 1;color: #ff6700; margin: 0 0 5px 0;">400-100-5678</p>
                <p style="font-size: 12px; margin: 0 0 5px 0;">8:00-18:00(仅收市话费)</p>
                <a class="ke" href=""><em class="iconfont icon-xinxi"></em>人工客服</a>
                <div class="follow">关注小米：
                    <a><i class="iconfont icon-logo-weibo
                        "></i></a>
                    <a><i class="iconfont icon-weixin"></i></a>
                </div>
            </div>
        </div>
        <div class="three clean">
            <div class="two clean">
                <div class="lg"></div>
                <div class="info-text">
                    <p class="foot">
                        <a href="">小米商城</a>
                        <span>|</span>
                        <a href="">MIUI</a>
                        <span>|</span>
                        <a href="">米家</a>
                        <span>|</span>
                        <a href="">米聊</a>
                        <span>|</span>
                        <a href="">多看</a>
                        <span>|</span>
                        <a href="">游戏</a>
                        <span>|</span>
                        <a href="">政企服务</a>
                        <span>|</span>
                        <a href="">小米天猫店</a>
                        <span>|</span>
                        <a href="">小米集团隐私政策</a>
                        <span>|</span>
                        <a href="">小米公司儿童信息保护规则</a>
                        <span>|</span>
                        <a href="">小米商城隐私政策</a>
                        <span>|</span>
                        <a href="">小米商城用户协议</a>
                        <span>|</span>
                        <a href="">问题反馈</a>
                        <span>|</span>
                        <a href="">Select Location</a>
                    </p>
                    <p class="foot">
                        <a href="">北京互联网法院法律服务工作站</a>
                        <span>|</span>
                        <a href="">中国消费者协会</a>
                        <span>|</span>
                        <a href="">北京市消费者协会</a>
                    </p>
                    <p class="foot oo" style="color: #b0b0b0;font-size: 12px;">
                        ©
                        <a style="color: #b0b0b0;" href="">mi.com</a> 京ICP正10507号
                        <a href="">京ICP备1006444号</a>
                        <a href="">京公网安备11010802020134号</a>
                        <a href="">京网文[2020]0276-042号</a><br>
                        <a href="">(京)网协平台备字(2018)第00005号</a>
                        <a href="">互联网药品信息服务资格证 (京)-非经营性-2014-0090</a>
                        <a href="">营业执照</a>
                        <a href="">医疗器械质量公告</a>
                        <br>
                        <a href="">增值电信业务许可证</a>&nbsp; 网络食品经营备案 京食药网食备202010048&nbsp;
                        <a href="">食品经营许可证</a><br>
                        违法和不良信息举报电话：171-5104-4404 &nbsp;
                        <a href="">知识产权侵权投诉</a>
                        &nbsp; 本网站所列数据，除特殊说明，所有数据均出自我司实验室测试
                    </p>
                </div>
                <div class="info-link">
                    <a href=""><img src="https://i1.mifile.cn/f/i/17/site/truste.png" alt=""></a>
                    <a href=""><img src="https://s01.mifile.cn/i/v-logo-2.png" alt=""></a>
                    <a href=""><img src="https://xyt.xinchacha.com/img/icon/icon3.png" alt=""></a>
                    <a href=""><img src="https://i8.mifile.cn/b2c-mimall-media/ba10428a4f9495ac310fd0b5e0cf8370.png"
                            alt=""></a>
                    <a href="" id="act"><img class="active"
                            src="https://cnbj1.fds.api.xiaomi.com/b2c-misite-activity/f1ee261b96ae71e845efba398efeca02.png"
                            alt="">
                        <img src="https://cnbj1.fds.api.xiaomi.com/b2c-misite-activity/4fbb07080ae3182a693b8c31732a0665.png"
                            alt=""></a>
                </div>
                <div class="four">
                </div>
            </div>
        </div>
    </div>
    <script src="js/cookie.js"></script>
    <script src="js/index.js"></script>
    <script src="js/cart.js"></script>
    <script>
        var oIn = document.querySelector("#sp");
        var tU = document.querySelector("#tuichu");
        var denglu = document.querySelector("#denglu");
        var scr = document.querySelector("#scr");
        // if (getCookie("username")) {
        //oIn.innerHTML = getCookie("username");
        //denglu.style.display = "block";
        // } else {
        // denglu.style.display = "none";
        // }
        // console.log(tU)
        // tU.onclick = function () {
        // setCookie("username", "", -1);
        // location.href = "http://127.0.0.1:8080/"
        // }
        $("#sp").mouseover(function () {
            $("#sp").css("background-color", "#fff")
        })
        var swiper = new Swiper('.swiper-container', {
            spaceBetween: 30,
            effect: 'fade',
            autoplay: true,
            loop: true,
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
                autoplay: true,
            },
            navigation: {
                nextEl: '.swiper-button-next',
                prevEl: '.swiper-button-prev',
            },
        });
        $("#sp").hover(function () {
            $(".pingjia").slideDown()
        })
        $(".pingjia").mouseleave(function () {
            $(".pingjia").slideUp()
            $("#sp").css("background-color", "#333")
        })
        $(".one").hover(function () {
            console.log("1")
            $(".xiala").slideToggle("fast")
        })
        var a = 0;
        console.log($("#act"))
        setInterval(function () {
            if (a == 2) {
                a = 0;
            }
            $("#act img").eq(a).addClass("active").siblings().removeClass("active");
            a++
        }, 2000)
        $(".less li").eq(0).css({ "color": "#ff6700", "borderColor": "#ff6700" })
        $(".less li").eq(0).hover(function () {
            $(this).css({ "color": "#ff6700", "borderColor": "#ff6700" }).siblings().css({ "color": "#333", "borderColor": "#f5f5f5" })
            $(".sp6 ul").eq(0).addClass("chen").siblings().removeClass("chen");
            console.log($(".less li").index);
        })
        $(".less li").eq(1).hover(function () {
            $(".sp6 ul").eq(1).addClass("chen").siblings().removeClass("chen")
            $(this).css({ "color": "#ff6700", "borderColor": "#ff6700" }).siblings().css({ "color": "#333", "borderColor": "#f5f5f5" })
        })
        $.get("http://jx.xuzhixiang.top/ap/api/cart-list.php", {
            id: getCookie("miid")
        }).then(res => {
            let str = "";
            let arr = [];
            for (let i = 0; i < res.data.length; i++) {
                arr.push(res.data[i].pid)
                str += `
        <div class="row row1"}> 
        <div class="col-md-1 zhong"> 
        <i><input type="checkbox" id="checkone" class="ce"> </i> 
        </div> 
        <div class="col-md-1 zhong"> 
        <img src="${res.data[i].pimg}" 
        alt=""> 
        </div> 
        <div class="col-md-2 zhong">${res.data[i].pname}</div> 
        <div class="col-md-1 zhong"></div> 
        <div class="col-md-1 zhong">${res.data[i].pprice}</div> 
        <div class="col-md-2 "> 
        <div class="box2 "> 
        <li id="jian">-</li> 
        <input class="pum" id="${res.data[i].pid}" value="${res.data[i].pnum} ">
        <li id="jia">+</li> 
        </div> 
        </div> 
        <div class="col-md-1 zhong"></div> 
        <div class="col-md-1 zhong pprice">${res.data[i].pprice * res.data[i].pnum}</div> 
        <div class="col-md-1 zhong"></div> 
        <div class="col-md-1 yuan"> 
        <i class="del" id="${res.data[i].pid}">X</i> 
        </div> 
        </div> `;
            }
            fat.innerHTML = str;
            let fat9 = document.querySelector("#fat");
            let fatt = document.querySelector(".fat1");
            let fata = document.querySelector(".mi-carto");
            let gong = document.querySelector(".gong")
            let xuanze = document.querySelector(".xuanze")
            // console.log(gong, xuanze)
            if (fat9.children.length == 0) {
                fatt.style.display = "none";
                fata.style.display = "none";
            } else {
                fatt.style.display = "block";
                fata.style.display = "block";
            }
            // $("#jia").click(function () {
            // console.log($(this).index())
            // for (let j = 0; j < arr.length; j++) {
            // $.get("http://jx.xuzhixiang.top/ap/api/cart-update-num.php", {
            // pid: arr[j],
            // uid: 9087,
            // pnum: 1
            // }).then(res => {
            // location.href = "http://127.0.0.1:8080/cart.html"
            // })
            // }
            // })
            let checkall = document.querySelector("#checkAll")
            let checkone = document.querySelectorAll("#checkone")
            let pnum = document.querySelectorAll(".pum")
            gong.innerHTML = checkone.length;
            // console.log(checkall, checkone)

            for (let i = 0; i < checkone.length; i++) {
                //复选 点击单个复选框时，判断选中的数量和实际复选框的数量是否相同，如果相同，让全选复选框选中

                checkone[i].onclick = () => {
                    let count = 0; //计数用的，默认为0，每次点击时，重新开始计算
                    for (let j = 0; j < checkone.length; j++) {
                        if (checkone[j].checked) { //只要有选中的计数器+1
                            count++;
                        }
                    };
                    if (count === checkone.length) { //判断选中的数量和实际数量是否相同
                        checkall.checked = true;
                    } else {
                        checkall.checked = false;
                    }
                    getTotalPrice(); //这个操作也需要更新总价
                }
            }
            let pprice = document.querySelectorAll(".pprice")
            checkall.onclick = () => {
                // console.log($("input:checked"))
                // console.log("ok")
                //所有单个复选框的状态和checkAll的状态一致
                for (let i = 0; i < checkone.length; i++) {
                    checkone[i].checked = checkall.checked;
                }
                // this.getTotalPrice(); //点击全选复选框需要展示总价
                getTotalPrice();
            }
            let iq = document.querySelector(".iq");
            // let iq = document.querySelector(".iq");

            function getSum() {
                let a = 0;
                for (let i = 0; i < checkone.length; i++) {
                    //console.log($("#checkone").eq(i).parent().parent().siblings(".pprice"))
                    if ($(".ce").eq(i).prop("checked") == true) {
                        //console.log("1")
                        a += parseInt($(".ce").eq(i).parent().parent().siblings(".pprice").html());
                        // a=parseInt(a);
                    }
                    // console.log(($("#checkone").eq(1)))
                }
                return a;
            }
            // console.log(($(".ce")))
            function getTotalPrice() {
                let total = 0;
                let n = 0;
                for (let i = 0; i < checkone.length; i++) { //找到所有选中的商品，将单种商品总价累加即可得到所有商品总价
                    if (checkone[i].checked) {
                        total += Number(pprice[i].innerText); //字符串转数值
                        n++;
                    }
                };
                xuanze.innerText = n;
                iq.innerText = total + "元"; //将和放到DOM结构中
                // console.log(total)
            }
            // let num = pnum.value
            // console.log(num)
            $(".pum").on("input", function () {
                // console.log($(this).val())
                $.get("http://jx.xuzhixiang.top/ap/api/cart-update-num.php", {
                    pid: $(this).attr("id"),
                    uid: getCookie("miid"),
                    pnum: $(this).val()
                }).then(res => {
                    // console.log("1")
                    // location.href = "http://127.0.0.1:8080/cart.html"
                    $.get("http://jx.xuzhixiang.top/ap/api/cart-list.php", {
                        id: getCookie("miid")
                    }).then(res => {
                        for (let i = 0; i < pprice.length; i++) {
                            pprice[i].innerText = parseInt(res.data[i].pprice) * parseInt(res.data[i].pnum)
                        }
                    })
                })
            })
            console.log(pnum)
            let jia = document.querySelectorAll("#jia")
            for (let i = 0; i < pprice.length; i++) {
                jia[i].onclick = function () {
                    pnum[i].value++;
                    $.get("http://jx.xuzhixiang.top/ap/api/cart-update-num.php", {
                        pid: $(".pum").eq(i).attr("id"),
                        uid: getCookie("miid"),
                        pnum: pnum[i].value
                    }).then(res => {
                        // console.log("1")
                        // location.href = "http://127.0.0.1:8080/cart.html"
                        $.get("http://jx.xuzhixiang.top/ap/api/cart-list.php", {
                            id: getCookie("miid")
                        }).then(res => {
                            for (let i = 0; i < pprice.length; i++) {
                                pprice[i].innerText = parseInt(res.data[i].pprice) * parseInt(res.data[i].pnum)
                                getTotalPrice();
                            }
                        })
                    })
                }
            }
            let jian = document.querySelectorAll("#jian")
            for (let i = 0; i < pprice.length; i++) {
                jian[i].onclick = function () {
                    if (pnum[i].value <= 1) {
                        console.log("1")
                        pnum[i].value = 2;
                    }
                    pnum[i].value--;
                    $.get("http://jx.xuzhixiang.top/ap/api/cart-update-num.php", {
                        pid: $(".pum").eq(i).attr("id"),
                        uid: getCookie("miid"),
                        pnum: pnum[i].value
                    }).then(res => {
                        // console.log("1")
                        // location.href = "http://127.0.0.1:8080/cart.html"
                        $.get("http://jx.xuzhixiang.top/ap/api/cart-list.php", {
                            id: getCookie("miid")
                        }).then(res => {
                            for (let i = 0; i < pprice.length; i++) {
                                pprice[i].innerText = parseInt(res.data[i].pprice) * parseInt(res.data[i].pnum)
                                getTotalPrice();
                            }
                        })
                    })
                }
            }

            // getTotalPrice();
            $(".del").click(function () {
                console.log($(".iq"))
                // console.log($(this))
                $.get("http://jx.xuzhixiang.top/ap/api/cart-delete.php", {
                    pid: $(this).attr("id"),
                    uid: getCookie("miid")
                }).then(res => {
                    $.get("http://jx.xuzhixiang.top/ap/api/cart-list.php", {
                        id: getCookie("miid")
                    }).then(res => {
                        $(this).parent().parent().remove()
                        $(".iq").html(getSum())

                        if (fat9.children.length == 0) {
                            fatt.style.display = "none";
                            fata.style.display = "none";
                        } else {
                            fatt.style.display = "block";
                            fata.style.display = "block";
                        }
                        xuanze.innerText = $("input:checked").length - 1
                        gong.innerHTML = $(".ce").length;
                        // console.log($("input:checked").length)
                    })
                })
            })
        })
    </script>
</body>

</html>